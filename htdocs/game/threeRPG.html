<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - geometry - cube</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0px;
				background-color: #333777;
				overflow: hidden;
			}
		</style>
	</head>
	<body>

		<script src="../build/three.js"></script>
		
		<script>

			var camera, scene, renderer;
			var mesh, marmesh;
			var wFront, wBack, rotLeft, rotRight = "false";
			
			init();
			initLights();
			animate();

			function init() {

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 400;

				scene = new THREE.Scene();

				
				//there are 3 ways of loading an object to scene:
				
				//first: we are loading a texture followed by a three.js cube 
				var texture = new THREE.TextureLoader().load( 'textures/siteMoon.png' );

				var geometry = new THREE.BoxBufferGeometry( 20, 20, 20 );
				var material = new THREE.MeshBasicMaterial( { map: texture } );

				for(var i = 0; i < 20; i++){
				mesh = new THREE.Mesh( geometry, material );
				mesh.position.x += 20*i;
				scene.add( mesh );
				}
				
				var texturex = new THREE.TextureLoader().load( 'textures/grassFloor2.png' );
				var materialx = new THREE.MeshBasicMaterial( { map: texturex } );
				mesho = new THREE.Mesh( geometry, materialx );
				
				mesho.scale.x = mesho.scale.z = 100;
				mesho.position.y -= 60;
				scene.add(mesho);
				
				//second: we are using JSON files to load our objects, with materials and textures
				//those files can be generated by using the three.js blender plugin
				var loader = new THREE.JSONLoader();
				loader.load('models/marmel.json', function(geometry, materials) {
				mesh = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(materials));
				mesh.position.x -= 200;
				mesh.scale.x = mesh.scale.y = mesh.scale.z = 10;
				mesh.translation = THREE.GeometryUtils.center(geometry);
				scene.add(mesh);
				});
				
				//third: we are using javascript files and loading a texture afterwards
				//because the plugin used in blender is new and cannot save textures
				new THREE.ObjectLoader().load( 'models/bau.js', function ( object ) {
					object.traverse( function ( o ) {
					if ( o.type == "Mesh" && o.material && ! o.material.transparent ) {
					o.material.side = THREE.DoubleSide;
					}
					var material = new THREE.MeshLambertMaterial({
                     map: THREE.ImageUtils.loadTexture('textures/LOWBAU2.png')});
					var meshe = new THREE.Mesh(o.geometry, material);
					meshe.scale.x = meshe.scale.y = meshe.scale.z = 20;
					meshe.position.y -= 50;
					scene.add( meshe );
					} );
				} );
				
				
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0x3399ff);
				document.body.appendChild( renderer.domElement );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			
			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}
			
			//sets a global light with color = white
			function initLights() {
				var light = new THREE.AmbientLight(0xffffff);
				scene.add(light);
			}
			
			function animate() {

				requestAnimationFrame( animate );

				//the key events occur once, so we need to set a flag to keep the key "pressed"
				document.onkeydown = function(e) {
				  if(e.keyCode == 38) {
					wFront = true;
				  }
				  if(e.keyCode == 40) {
					wBack = true;
				  }
				  if(e.keyCode == 37) {
					rotLeft = true;
				  }
				  if(e.keyCode == 39) {
					rotRight = true;
				  }
				}
				document.onkeyup = function(e) {
				  if(e.keyCode == 38) {
					wFront = false;
				  }
				  if(e.keyCode == 40) {
					wBack = false;
				  }
				  if(e.keyCode == 37) {
					rotLeft = false;
				  }
				  if(e.keyCode == 39) {
					rotRight = false;
				  }
				}
				//vector to hold camera position
				var cam = new THREE.Vector3();
				camera.getWorldDirection(cam);
				
				//camera moves forward, based on it rotation
				if(wFront == true){ camera.position.x += cam.x; camera.position.z += cam.z;}
				if(wBack == true){ camera.position.x -= cam.x; camera.position.z -= cam.z;}
				if(rotLeft == true){camera.rotation.y += 0.02;}
				if(rotRight == true){camera.rotation.y -= 0.02;}
				//camera.rotation.z += 0.001;
				mesh.rotation.x += 0.005;
				mesh.rotation.y += 0.01;

				
				renderer.render( scene, camera );

			}

		</script>
		<div>
			<h1>Bom Dia! SkyNeide!</h1>
		</div>
	</body>
</html>
